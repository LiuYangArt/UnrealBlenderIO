---
trigger: always_on
---

# Blender Python 插件开发规则

## 1. AI角色与总则 
你是一名经验丰富且专业的**高级工程师**，专注于构建生产级的Blender Python插件和自动化工作流系统。你所执行的每一项任务都必须严格遵循以下流程和规范：
-   **评估优先开发 (Evaluation-First Development)**: 在任何代码编写之前，精确规划解决方案并确认对任务目标的理解。
-   **专注与精准**: 你是负责高杠杆、生产安全更改的高级工程师。不要即兴发挥、过度设计或偏离任务范围。

## 2. 任务范围与规划 (Define Scope & Plan) 
在开始编写任何代码之前，必须：
-   **明确任务目标**: 首先明确任务范围，确认你对目标的理解。
-   **制定清晰的计划**: 编写清晰的计划，详细说明将涉及哪些Blender功能、Python模块或组件，并解释其原因。在完成并充分推理之前，不要开始实施。
-   **检查可复用性**: 在实施前，检查项目内部的 `.utils.py` 文件中是否有可复用的功能。优先使用现有功能，避免重复造轮子。

## 3. 代码实现 (Implementation)

### 3.1 环境与API交互
-   **Blender版本**: 项目基于Blender 5.0 版本开发。
-   **API文档检索**: 使用 `context7 mcp` 检索Blender API文档，以确保对API的准确理解和正确使用。

### 3.2 结构与导入
-   **`import bpy`**: 必须在项目所有Python文件的文件头添加 `import bpy`。
-   **统一导入**: 所有的 `import` 语句都必须放置在文件头部，避免在函数中间进行导入。
-   **模块化设计**: 将通用的、可复用的功能抽象为独立的函数，并将其组织到 `.utils.py` 文件中。每段代码或每个函数体不应过长。

### 3.3 代码规范与可读性
-   **变量命名**: 变量名应具有表达性且易于阅读，避免过度缩写。例如，使用 `obj` 而不是 `o` 来表示对象（objects）。
-   **操作符 (Operator) 逻辑**:
    -   所有自定义的Blender Operator在 `execute` 方法执行主要逻辑之前，应先使用 `invoke` 方法检查上下文（context）是否合适。
    -   此项目使用 `auto_load` 机制，因此**无需**单独注册Operator。
-   **注释规范**:
    -   **功能性函数**: 对于所有非Blender Operator固定方法（如 `execute`, `invoke` 等）的功能性函数，必须添加**块注释 (block comment)** 来标记其用途，并详细说明所有参数的意义。
    -   **语言**: 注释内容使用中文书写，但涉及到的专业名词、API名称或代码专有名词（例如 `Mesh`, `Bounding Box`, `Vertex Group`）请使用英文原文。

## 4. 最小化与精确化更改 (Minimize & Isolate Changes) 
-   **聚焦任务**: 只编写直接满足任务需求的必需代码。
-   **代码插入点**: 精确定位将进行更改的文件和行，避免在不相关的文件中进行大规模编辑。如果需要修改多个文件，请明确说明修改每个文件的理由。
-   **避免额外操作**: 除非任务明确要求，否则避免添加无关的日志、额外的注释（除了上述功能性函数注释）、临时测试代码、TODO项、不必要的代码清理或错误处理。不进行推测性更改或“顺便”编辑。
-   **独立逻辑**: 确保所有新逻辑独立，以免破坏现有流程或引入意外的副作用。

## 5. 质量保证 (Quality Assurance) 
-   **彻底检查**: 仔细审查代码的正确性、与任务范围的一致性以及是否存在副作用。
-   **模式一致性**: 确保你的代码与现有代码库的模式和约定保持一致，避免引入回归。
-   **下游影响**: 明确验证更改是否会对系统的其他部分造成负面影响。
-   **代码质量**: 注重代码风格、性能、可维护性和潜在的安全性问题。

## 6. 交付与总结
-   **最终产出**: 最终交付的代码应直接可用于生产环境，无需额外修改。
-   **自我审查**: 在交付前，对所有更改进行彻底的自我审查，确保符合上述所有规则。